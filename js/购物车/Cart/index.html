<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" type="text/css" href="css/reset.css" />
    <link rel="stylesheet" type="text/css" href="css/cart.css" />
</head>

<body>
    <div id="main" class="hander-car">
        <div class="store-content">
            <div class="cart-box">
                <div class="title">
                    <h2>购物清单</h2>
                </div>
                <div class="cart-inner">
                    <div>
                        <div class="cart-table-title">
                            <span class="name">商品信息</span>
                            <span class="operation">操作</span>
                            <span class="subtotal">小计</span>
                            <span class="num">数量</span>
                            <span class="price">单价</span>
                        </div>
                        <div class="cart-table">
                            <div class="cart-group">
                                <!--购物列表-->
                                <div class="cart-top-items">
                                    <div class="cart-items">
                                        <div class="items-choose">
                                            <!-- 勾选商品  选中：checkbox-on -->
                                            <span class="blue-checkbox-new"><a></a></span>
                                        </div>
                                        <div class="items-thumb">
                                            <img src="./img/goods/s1.jpg">
                                            <a href="javascript:;" target="_blank"></a>
                                        </div>
                                        <div class="name hide-row">
                                            <div class="name-table">
                                                <a href="javascript:;" target="_blank">坚果 Pro 钢化玻璃手感膜 无孔 （后壳用）</a>
                                                <ul class="attribute">
                                                    <li>透明</li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="operation">
                                        </div>
                                        <!-- 小计 -->
                                        <div class="subtotal">¥ 49.00</div>
                                        <!-- 件数的操作 -->
                                        <div class="item-cols-num">
                                            <div class="select js-select-quantity">
                                                <span class="down down-disabled">-</span>
                                                <span class="num">
                                                    <input type="text" value="1" style="display: inline-block;">
                                                </span>
                                                <span class="up">+</span>

                                            </div>
                                        </div>
                                        <!-- 单价 -->
                                        <div class="price">¥ 100.00</div>
                                    </div>
                                </div>
                                <div class="cart-top-items">
                                    <div class="cart-items">
                                        <div class="items-choose">
                                            <span class="blue-checkbox-new"><a></a></span>
                                        </div>
                                        <div class="items-thumb">
                                            <img src="./img/goods/s1.jpg">
                                            <a href="javascript:;" target="_blank"></a>
                                        </div>
                                        <div class="name hide-row">
                                            <div class="name-table">
                                                <a href="javascript:;" target="_blank">坚果 Pro 钢化玻璃手感膜 无孔 （后壳用）</a>
                                                <ul class="attribute">
                                                    <li>透明</li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="operation">
                                        </div>
                                        <div class="subtotal">¥ 49.00</div>
                                        <div class="item-cols-num">
                                            <div class="select js-select-quantity">
                                                <span class="down down-disabled">-</span>
                                                <span class="num">
                                                    <input type="text" value="1" style="display: inline-block;">
                                                </span>
                                                <span class="up">+</span>

                                            </div>
                                        </div>
                                        <div class="price">¥ 200.00</div>
                                    </div>
                                </div>
                                <div class="cart-top-items">
                                    <div class="cart-items">
                                        <div class="items-choose">
                                            <span class="blue-checkbox-new"><a></a></span>
                                        </div>
                                        <div class="items-thumb">
                                            <img src="./img/goods/s1.jpg">
                                            <a href="javascript:;" target="_blank"></a>
                                        </div>
                                        <div class="name hide-row">
                                            <div class="name-table">
                                                <a href="javascript:;" target="_blank">坚果 Pro 钢化玻璃手感膜 无孔 （后壳用）</a>
                                                <ul class="attribute">
                                                    <li>透明</li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="operation">
                                        </div>
                                        <div class="subtotal">¥ 49.00</div>
                                        <div class="item-cols-num">
                                            <div class="select js-select-quantity">
                                                <span class="down down-disabled">-</span>
                                                <span class="num">
                                                    <input type="text" value="4" style="display: inline-block;">
                                                </span>
                                                <span class="up">+</span>

                                            </div>
                                        </div>
                                        <div class="price">¥ 49.00</div>
                                    </div>
                                </div>
                                <div class="cart-top-items">
                                    <div class="cart-items">
                                        <div class="items-choose">
                                            <span class="blue-checkbox-new"><a></a></span>
                                        </div>
                                        <div class="items-thumb">
                                            <img src="./img/goods/s1.jpg">
                                            <a href="javascript:;" target="_blank"></a>
                                        </div>
                                        <div class="name hide-row">
                                            <div class="name-table">
                                                <a href="javascript:;" target="_blank">坚果 Pro 钢化玻璃手感膜 无孔 （后壳用）</a>
                                                <ul class="attribute">
                                                    <li>透明</li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="operation">
                                        </div>
                                        <div class="subtotal">¥ 49.00</div>
                                        <div class="item-cols-num">
                                            <div class="select js-select-quantity">
                                                <span class="down down-disabled">-</span>
                                                <span class="num">
                                                    <input type="text" value="2" style="display: inline-block;">
                                                </span>
                                                <span class="up">+</span>

                                            </div>
                                        </div>
                                        <div class="price">¥ 58.00</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="cart-bottom-bg fix-bottom">
                    <div class="cart-bar-operation">
                        <div>
                            <div class="choose-all js-choose-all">
                                <span class="blue-checkbox-new"><a></a></span>
                                全选
                            </div>
                            <!-- <div class="delete-choose-goods">删除选中的商品</div> -->
                        </div>
                    </div>
                    <div class="shipping">
                        <div class="shipping-box">
                            <div class="shipping-total shipping-num">
                                <h4 class="">
                                    已选择 <i>0</i> 件商品
                                </h4>
                                <h5>
                                    共计 <i>3</i> 件商品
                                </h5>
                            </div>
                            <div class="shipping-total shipping-price">
                                <h4 class="">
                                    应付总额：<span>￥</span><i class="moneyall">0</i>
                                </h4>
                                <h5 class="shipping-tips">
                                    应付总额不含运费
                                </h5>

                            </div>
                        </div>
                        <span class="jianguo-blue-main-btn big-main-btn js-checkout disabled-btn"><a>现在结算</a></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        var blueCheckboxes = document.querySelectorAll('.items-choose .blue-checkbox-new');
        var ups = document.querySelectorAll('.up');
        var downs = document.querySelectorAll('.down');
        var numInputs = document.querySelectorAll('.num input');
        var prices = document.querySelectorAll('.cart-items .price');
        var subtotals = document.querySelectorAll('.cart-items .subtotal');
        var chooseAll = document.querySelector('.choose-all .blue-checkbox-new');
        var totalNum = document.querySelector('.shipping-total h5 i');
        var nowBuy = document.querySelector('.jianguo-blue-main-btn');

        var checkedNum = document.querySelector('.shipping-total h4 i');
        var moneyall = document.querySelector('.moneyall');
        console.log(blueCheckboxes)

        var alltrue = false;
        //页面生成的时候页获取总计数
        getTotalNum();

        for (var i = 0; i < blueCheckboxes.length; i++) {
            blueCheckboxes[i].ischeck = false;
            ups[i].index = i;
            downs[i].index = i;
            //单选
            blueCheckboxes[i].onclick = function () {
                // if (this.ischeck) {
                //     // this.className=('blue-checkbox-new');
                //     // this.classList.remove('checkbox-on');
                // } else {
                //     // this.className=('blue-checkbox-new checkbox-on');
                //     // this.classList.add('checkbox-on')
                // }
                // this.ischeck?this.classList.remove('checkbox-on'):this.classList.add('checkbox-on');
                this.classList[this.ischeck?'remove':'add']('checkbox-on');
                this.ischeck = !this.ischeck;
                isChoose();
                setClass();
                getCheckNum();
            }

            //加数量
            ups[i].onclick = function(){
               //这里的this指向ups[i]元素 解决可以i定义索引属性 即使指定ups[i]也没有关系
               var value = numInputs[this.index].value
               //取最小值 最大能10
               var num = Math.min(Number(value)+1,10);
               num ==10 && this.classList.add('up-disabled');
            //    value++
            //    if(value>10){
            //     value=10
            //     return
            //    }
            //    if(value==10){
            //        this.classList.add('up-disabled');
            //    }

            //    numInputs[this.index].value = value
            numInputs[this.index].value = num;
            downs[this.index].classList.remove('down-disabled');
            subtotals[this.index].innerHTML='￥ '+getSubtotal(prices[this.index].innerHTML,numInputs[this.index].value)+'.00';
            getTotalNum();
            getCheckNum();
            }

            //减数量
            downs[i].onclick = function(){
               //这里的this指向downs[i]元素 解决可以i定义索引属性 即使指定downs[i]也没有关系
               var value = numInputs[this.index].value
               //取最小值 最大能10
               var num = Math.max(Number(value)-1,1);
               num ==1 && this.classList.add('down-disabled');
                           
            //    value--
            //    if(value<1){
            //     value=1
            //     return
            //    }
            //    if(value==1){
            //        this.classList.add('down-disabled');
            //    }

            //    numInputs[this.index].value = value

            numInputs[this.index].value = num;
            ups[this.index].classList.remove('up-disabled');
            subtotals[this.index].innerHTML='￥ '+getSubtotal(prices[this.index].innerHTML,numInputs[this.index].value)+'.00';
            getTotalNum();
            getCheckNum();
            
            }
            //判断++ --的按钮是否可以点击
            downs[i].classList[numInputs[i].value==1?'add':'remove']('down-disabled');
            ups[i].classList[numInputs[i].value==10?'add':'remove']('up-disabled');
           
            //小计
            subtotals[i].innerHTML='￥ '+getSubtotal(prices[i].innerHTML,numInputs[i].value)+'.00';
            
            // var totalMoney = 0;
            // // 字符串方法把￥移除 trim()去除空格
            // totalMoney = prices[i].innerHTML.slice(1).trim() * numInputs[i].value;
            // // console.log(totalMoney)
            // //toFixed(2) 字符串方法 保留两位小数点
            // subtotals[i].innerHTML = '￥ ' + totalMoney.toFixed(2);

            


        }

        //点击全选按钮
        chooseAll.onclick = function(){
            this.classList[alltrue?'remove':'add']('checkbox-on');
            blueCheckboxes.forEach(item=>{
                item.classList[!alltrue?'add':'remove']('checkbox-on');
                item.ischeck = !alltrue;
            })
            alltrue=!alltrue;
            setClass();
            getCheckNum();
        }

        // 封装小计 点击加减都要做这样的操作
        function getSubtotal(str,num){
            var totalMoney = 0;
            // str = str.slice(1).trim();
            totalMoney = str.slice(1).trim() * num;
            
            return Number(totalMoney.toFixed(2));
        }
       //处理是否全选状态
        function isChoose(){
            var ischoose = [...blueCheckboxes].every(item=>item.ischeck);
            // console.log(ischoose)
            // if(ischoose){
            //     chooseAll.classList.add('checkbox-on');
            // }else{
            //     chooseAll.classList.remove('checkbox-on');
            // }
            chooseAll.classList[ischoose?'add':'remove']('checkbox-on');
        }
        //获取总计件数
        function getTotalNum(){
            var totalnum = 0;
            totalnum = [...numInputs].reduce((a,b)=>{
                b = Number(b.value);
                return a+b
            },0)
            totalNum.innerHTML = totalnum;
        }

        //设置现在结算按钮
        function setClass(){
            var isAllChecked = [...blueCheckboxes].some(item=>item.ischeck);
            nowBuy.classList[!isAllChecked?'add':'remove']('disabled-btn');
        }

        //设置选中的商品件数和应付金额
        function getCheckNum(){
            var checknum = 0;
			var moneyA = 0;
            blueCheckboxes.forEach((item,index)=>{
                if(item.ischeck){
                    checknum += Number(numInputs[index].value);
                    moneyA += getSubtotal(prices[index].innerHTML,numInputs[index].value);
                    // console.log(moneyA)
                }
                return;
            })
            checkedNum.innerHTML = checknum;
            moneyall.innerHTML = moneyA+'.00';
        }

        /**
         选中: checkbox-on
         结算按钮样式: disabled-btn
         加减按钮禁用：down-disabled
         */
    </script>
</body>

</html>